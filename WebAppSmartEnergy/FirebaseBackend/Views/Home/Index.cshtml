<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Stack - Bootstrap 4 Business Template</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="~/assets/css/bootstrap.min.css">
    <!-- Icon -->
    <link rel="stylesheet" href="~/assets/fonts/line-icons.css">
    <!-- Slicknav -->
    <link rel="stylesheet" href="~/assets/css/slicknav.css">
    <!-- Owl carousel -->
    <link rel="stylesheet" href="~/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="~/assets/css/owl.theme.css">

    <link rel="stylesheet" href="~/assets/css/magnific-popup.css">
    <link rel="stylesheet" href="~/assets/css/nivo-lightbox.css">
    <!-- Animate -->
    <link rel="stylesheet" href="~/assets/css/animate.css">
    <!-- Main Style -->
    <link rel="stylesheet" href="~/assets/css/main.css">
    <!-- Responsive Style -->
    <link rel="stylesheet" href="~/assets/css/responsive.css">
    <style>
        .table-danger {
            background-color: #f8d7da !important;
            color: #721c24 !important;
        }

        .stepper {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-bottom: 2px solid #ddd;
            color: #777;
        }

            .step.active {
                border-color: #007bff;
                color: #007bff;
            }

    </style>


</head>
<body>

    <header id="header-wrap">
        <!-- Navbar Start -->
        <nav class="navbar navbar-expand-md bg-inverse fixed-top scrolling-navbar">
            <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                <a href="~/index.html" class="navbar-brand"><img src="assets/img/logo.jpg" width="100px"  alt=""></a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="lni-menu"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto w-100 justify-content-end clearfix">
                        <li class="nav-item active">
                            <a class="nav-link" href="~/#hero-area">
                                Home
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="~/#feature">
                                Feature
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="~/#services">
                                Services
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="~/#team">
                                Team
                            </a>
                        </li>
                       
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Navbar End -->
        <!-- Hero Area Start -->
        <div id="hero-area" class="hero-area-bg">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 col-sm-12">
                        <div class="contents text-center">
                            <h2 class="head-title wow fadeInUp">Optimize Energy Consumption<br> in Your Crypto-Mining Facility</h2>
                            <div class="header-button wow fadeInUp" data-wow-delay="0.3s">
                                <button type="button" class="btn btn-common" data-toggle="modal" data-target="#stepperModal">
                                    Start Monitoring
                                </button>
                            </div>
                        </div>
                        <div class="img-thumb text-center wow fadeInUp" data-wow-delay="0.6s">
                            <img class="img-fluid" src="assets/img/hero-1.png" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hero Area End -->

    </header>
    <!-- Header Area wrapper End -->
    <!-- Feature Section Start -->
    <div id="feature">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-6 col-md-12 col-sm-12">
                    <div class="text-wrapper">
                        <div>
                            <h2 class="title-hl wow fadeInLeft" data-wow-delay="0.3s">Real-time Monitoring <br> of Your Energy Consumption</h2>
                            <p class="mb-4">With our IoT solution and advanced predictive models, identify consumption peaks and optimize your energy resources for sustainable management.</p>
                            <a href="#services" class="btn btn-common">Learn More</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-12 col-sm-12 padding-none feature-bg">
                    <div class="feature-thumb">
                        <div class="feature-item wow fadeInDown" data-wow-duration="1000ms" data-wow-delay="300ms">
                            <div class="icon">
                                <i class="lni-stats-up"></i>
                            </div>
                            <div class="feature-content">
                                <h3>GPU Monitoring</h3>
                                <p>Visualize real-time consumption data for each GPU, identify anomalies, and act quickly.</p>
                            </div>
                        </div>
                        <div class="feature-item wow fadeInDown" data-wow-duration="1000ms" data-wow-delay="500ms">
                            <div class="icon">
                                <i class="lni-bulb"></i>
                            </div>
                            <div class="feature-content">
                                <h3>Energy Prediction</h3>
                                <p>Using AI, anticipate energy needs and adjust your operations to avoid waste.</p>
                            </div>
                        </div>
                        <div class="feature-item wow fadeInDown" data-wow-duration="1000ms" data-wow-delay="700ms">
                            <div class="icon">
                                <i class="lni-cog"></i>
                            </div>
                            <div class="feature-content">
                                <h3>Smart Alerts</h3>
                                <p>Receive notifications when thresholds are exceeded for quick and effective intervention.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Services Section Start -->
    <section id="services" class="section-padding bg-gray">
        <div class="container">
            <div class="section-header text-center">
                <h2 class="section-title wow fadeInDown" data-wow-delay="0.3s">Our Services</h2>
                <p>Custom solutions for energy management in your mining infrastructure.</p>
            </div>
            <div class="row">
                <!-- Services item -->
                <div class="col-md-6 col-lg-4 col-xs-12">
                    <div class="services-item wow fadeInRight" data-wow-delay="0.3s">
                        <div class="icon">
                            <i class="lni-bolt"></i>
                        </div>
                        <div class="services-content">
                            <h3><a href="#">Energy Monitoring</a></h3>
                            <p>Access detailed reports on the energy consumption of your equipment.</p>
                        </div>
                    </div>
                </div>
                <!-- Services item -->
                <div class="col-md-6 col-lg-4 col-xs-12">
                    <div class="services-item wow fadeInRight" data-wow-delay="0.6s">
                        <div class="icon">
                            <i class="lni-cog"></i>
                        </div>
                        <div class="services-content">
                            <h3><a href="#">Advanced Analytics</a></h3>
                            <p>Leverage your data to optimize energy performance and reduce costs.</p>
                        </div>
                    </div>
                </div>
                <!-- Services item -->
                <div class="col-md-6 col-lg-4 col-xs-12">
                    <div class="services-item wow fadeInRight" data-wow-delay="0.9s">
                        <div class="icon">
                            <i class="lni-alarm"></i>
                        </div>
                        <div class="services-content">
                            <h3><a href="#">Alert System</a></h3>
                            <p>Receive real-time alerts for any anomalies detected in your consumption data.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section End -->
    <!-- Start Video promo Section -->
    <section class="video-promo section-padding text-center">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <h2 style="color: #fff;">Optimize Your Energy Consumption</h2>
                    <h5>Manage your resources efficiently with our advanced energy monitoring platform.</h5>
                </div>
            </div>
        </div>
    </section>
    <!-- End Video Promo Section -->
    <!-- Team Section Start -->
    <section id="team" class="section-padding text-center">
        <div class="container">
            <div class="section-header text-center">
                <h2 class="section-title wow fadeInDown" data-wow-delay="0.3s">Our Team</h2>
                <p>Experts dedicated to optimizing your energy consumption and driving technological innovation.</p>
            </div>
            <div class="row justify-content-center">
                <div class="col-sm-6 col-md-4 col-lg-4">
                    <!-- Team Item Starts -->
                    <div class="team-item text-center wow fadeInRight" data-wow-delay="0.3s">
                        <div class="team-img">
                            <img class="img-fluid" src="assets/img/team/engineer-01.jpeg" alt="Data Engineer">
                        </div>
                        <div class="info-text">
                            <h3>ABBASSI Momtez</h3>
                            <p>Hardware setup, data storage solutions & predictive analytics</p>
                        </div>
                    </div>
                    <!-- Team Item Ends -->
                </div>
                <div class="col-sm-6 col-md-4 col-lg-4">
                    <!-- Team Item Starts -->
                    <div class="team-item text-center wow fadeInRight" data-wow-delay="0.6s">
                        <div class="team-img">
                            <img class="img-fluid" src="assets/img/team/engineer-02.jpeg" alt="Sensor Integration Specialist">
                        </div>
                        <div class="info-text">
                            <h3>HAMMOUDA Ons</h3>
                            <p>Conception & sensor integration for energy monitoring</p>
                        </div>
                    </div>
                    <!-- Team Item Ends -->
                </div>
                <div class="col-sm-6 col-md-4 col-lg-4">
                    <!-- Team Item Starts -->
                    <div class="team-item text-center wow fadeInRight" data-wow-delay="0.9s">
                        <div class="team-img">
                            <img class="img-fluid" src="assets/img/team/engineer-03.jpeg" alt="Full-Stack Developer">
                        </div>
                        <div class="info-text">
                            <h3>ALAOUI Houcem</h3>
                            <p>Backend & Frontend Development</p>
                        </div>
                    </div>
                    <!-- Team Item Ends -->
                </div>
            </div>
        </div>
    </section>

    <!-- Team Section End -->
    <!-- Counter Section Start -->
    <section id="counter" class="section-padding">
        <div class="overlay"></div>
        <div class="container">
            <div class="row justify-content-between">
                <div class="col-lg-12 col-md-12 col-xs-12">
                    <div class="row">
                        <!-- Start counter -->
                        <div class="col-lg-3 col-md-6 col-xs-12">
                            <div class="counter-box wow fadeInUp" data-wow-delay="0.2s">
                                <div class="icon-o"><i class="lni-users"></i></div>
                                <div class="fact-count">
                                    <h3><span class="counter">150</span></h3>
                                    <p>Connected Facilities</p>
                                </div>
                            </div>
                        </div>
                        <!-- End counter -->
                        <!-- Start counter -->
                        <div class="col-lg-3 col-md-6 col-xs-12">
                            <div class="counter-box wow fadeInUp" data-wow-delay="0.4s">
                                <div class="icon-o"><i class="lni-emoji-smile"></i></div>
                                <div class="fact-count">
                                    <h3><span class="counter">500</span></h3>
                                    <p>Alerts Resolved</p>
                                </div>
                            </div>
                        </div>
                        <!-- End counter -->
                        <!-- Start counter -->
                        <div class="col-lg-3 col-md-6 col-xs-12">
                            <div class="counter-box wow fadeInUp" data-wow-delay="0.6s">
                                <div class="icon-o"><i class="lni-download"></i></div>
                                <div class="fact-count">
                                    <h3><span class="counter">3000</span></h3>
                                    <p>Reports Generated</p>
                                </div>
                            </div>
                        </div>
                        <!-- End counter -->
                        <!-- Start counter -->
                        <div class="col-lg-3 col-md-6 col-xs-12">
                            <div class="counter-box wow fadeInUp" data-wow-delay="0.8s">
                                <div class="icon-o"><i class="lni-thumbs-up"></i></div>
                                <div class="fact-count">
                                    <h3><span class="counter">250</span></h3>
                                    <p>Partners</p>
                                </div>
                            </div>
                        </div>
                        <!-- End counter -->
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Counter Section End -->
    <!-- Counter Section End -->
    <!-- Counter Section End -->
    <!-- Modal Stepper -->
    <div class="modal fade" id="stepperModal" tabindex="-1" aria-labelledby="stepperModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="stepperModalLabel">Analysis Process</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Stepper Navigation -->
                    <div class="stepper">
                        <div class="step" data-step="1">1. Login</div>
                        <div class="step" data-step="2">2. View Real-Time Data</div>
                    </div>
                    <!-- Step 1: Login -->
                    <div class="step-content" id="step-1">
                        <h5>Login</h5>
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
                            </div>
                            <button type="button" class="btn btn-primary" id="loginButton">Log In</button>
                        </form>
                    </div>
                    <!-- Step 2: Data Analysis -->
                    <div class="step-content d-none" id="step-2">
                        <h5>Real-Time Data</h5>
                        <div id="modal-content-placeholder">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Current</th>
                                        <th>Voltage</th>
                                        <th>kWh</th>
                                        <th>Time</th>
                                    </tr>
                                </thead>
                                <tbody id="firebase-data-body"></tbody>
                            </table>
                        </div>
                        <canvas id="dataChart" style="width: 100%; height: 400px;"></canvas>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div id="alert-container" style="position: fixed; top: 20px; right: 20px; z-index: 1050;"></div>
    <div class="modal fade" id="chartModal" tabindex="-1" aria-labelledby="chartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="chartModalLabel">Data Analysis</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <canvas id="dataChart" style="width: 100%; height: 400px;"></canvas>
                    <p id="dataAnalysis" class="mt-4"></p>
                </div>
            </div>
        </div>
    </div>





    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="~/assets/js/jquery-min.js"></script>
    <script src="~/assets/js/popper.min.js"></script>
    <script src="~/assets/js/bootstrap.min.js"></script>
    <script src="~/assets/js/owl.carousel.min.js"></script>
    <script src="~/assets/js/wow.js"></script>
    <script src="~/assets/js/jquery.nav.js"></script>
    <script src="~/assets/js/scrolling-nav.js"></script>
    <script src="~/assets/js/jquery.easing.min.js"></script>
    <script src="~/assets/js/jquery.counterup.min.js"></script>
    <script src="~/assets/js/waypoints.min.js"></script>
    <script src="~/assets/js/jquery.slicknav.js"></script>
    <script src="~/assets/js/main.js"></script>
   

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modalContentBody = document.getElementById('firebase-data-body');
            const dataChart = document.getElementById('dataChart');
            const dataAnalysis = document.getElementById('dataAnalysis');
            let chartInstance; // Instance du graphique Chart.js
            let allData = []; // Tableau global pour stocker toutes les données récupérées

            // Fonction pour ajouter une ligne dans le tableau
            const addRowToTable = (data) => {
                const isVoltageHigh = parseFloat(data.voltage) > 200;

                // Ajouter une nouvelle ligne
                const newRow = `
                    <tr class="${isVoltageHigh ? 'table-danger' : ''}">
                        <td>${data.current || "N/A"}</td>
                        <td>${data.voltage || "N/A"}</td>
                        <td>${data.kWh || "N/A"}</td>
                        <td>${data.temps || "N/A"}</td>
                    </tr>
                `;
                modalContentBody.innerHTML += newRow;

                // Affiche une alerte si le voltage dépasse une limite
                if (isVoltageHigh) {
                    showAlert(`Alerte : le voltage (${data.voltage}V) dépasse la limite autorisée !`, "danger");
                }
            };

            // Fonction pour afficher une alerte
            const showAlert = (message, type) => {
                const alertContainer = document.getElementById('alert-container');
                const alert = document.createElement('div');

                alert.className = `alert alert-${type} alert-dismissible fade show`;
                alert.role = "alert";
                alert.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                `;

                alertContainer.appendChild(alert);

                // Supprime automatiquement l'alerte après 5 secondes
                setTimeout(() => {
                    alert.remove();
                }, 5000);
            };

            // Fonction pour récupérer les données depuis l'API
            const updateFirebaseData = async () => {
                try {
                    const response = await fetch('/api/Firebase/data');
                    if (!response.ok) throw new Error(`Erreur HTTP : ${response.status}`);

                    const data = await response.json(); // Parsez les données JSON
                    if (data && !data.Message) {
                        allData.push(data); // Ajoute les nouvelles données dans le tableau global
                        if (allData.length > 20) allData.shift(); // Limite à 20 points
                        addRowToTable(data); // Ajoute les données au tableau
                        console.log('Données mises à jour :', allData);
                    }
                } catch (error) {
                    console.error('Erreur lors de la récupération des données :', error);
                }
            };

            // Fonction pour générer le graphique
            const generateChart = () => {
                if (allData.length === 0) {
                    console.warn('Aucune donnée disponible pour générer le graphique.');
                    dataAnalysis.innerHTML = '<p class="text-danger">Aucune donnée disponible pour l\'analyse.</p>';
                    return;
                }

                const labels = allData.map((_, index) => `Point ${index + 1}`);
                const voltageData = allData.map(data => parseFloat(data.voltage));
                const currentData = allData.map(data => parseFloat(data.current));

                // Détruire l'ancien graphique s'il existe
                if (chartInstance) {
                    chartInstance.destroy();
                }

                // Créer un nouveau graphique
                chartInstance = new Chart(dataChart, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Voltage (V)',
                                data: voltageData,
                                borderColor: 'rgba(255, 99, 132, 1)',
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                fill: true,
                                tension: 0.4,
                            },
                            {
                                label: 'Current (A)',
                                data: currentData,
                                borderColor: 'rgba(54, 162, 235, 1)',
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                fill: true,
                                tension: 0.4,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: true, text: 'Analyse des Données Firebase' },
                        },
                    },
                });

                // Analyse des données
                const averageVoltage = (voltageData.reduce((sum, val) => sum + val, 0) / voltageData.length).toFixed(2);
                const maxVoltage = Math.max(...voltageData).toFixed(2);
                const minVoltage = Math.min(...voltageData).toFixed(2);

                dataAnalysis.innerHTML = `
                    <strong>Analyse :</strong><br>
                    - Moyenne du voltage : ${averageVoltage} V<br>
                    - Voltage maximum : ${maxVoltage} V<br>
                    - Voltage minimum : ${minVoltage} V<br>
                    - Nombre total de points : ${voltageData.length}
                `;
            };

            // Ajouter un événement pour afficher le graphique lors de l'ouverture du modal
            const chartModal = document.getElementById('chartModal');
            chartModal.addEventListener('show.bs.modal', () => {
                generateChart();
            });

            // Rafraîchissez les données toutes les 5 secondes
            setInterval(updateFirebaseData, 5000);

            // Initialisez les données immédiatement à l'ouverture du modal
            document.getElementById('firebaseModal').addEventListener('show.bs.modal', updateFirebaseData);
        });


                document.addEventListener('DOMContentLoaded', () => {
            const loginButton = document.getElementById('loginButton');
            const step1 = document.getElementById('step-1');
            const step2 = document.getElementById('step-2');

            // Gestion de la connexion
            loginButton.addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                if (email && password) {
                    // Simuler une validation (remplacez avec votre API d'authentification)
                    if (email === "test@example.com" && password === "password123") {
                        alert("Connexion réussie !");
                        step1.classList.add('d-none');
                        step2.classList.remove('d-none');
                    } else {
                        alert("Email ou mot de passe incorrect.");
                    }
                } else {
                    alert("Veuillez remplir tous les champs.");
                }
            });

            // Initialisez la récupération des données Firebase après connexion
            step2.addEventListener('show.bs.modal', () => {
                updateFirebaseData();
            });
        });

    </script>


</body> 

</html>

